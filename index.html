<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta http-equiv="ScreenOrientation" content="autoRotate:disabled">
    <title>Monk Journey</title>

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="images/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png">

    <link rel="stylesheet" href="css/main.css">
    <!-- Font Awesome removed and replaced with custom icon.css -->
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#FFCC00">
    <meta name="description" content="A Diablo Immortal inspired game featuring a monk character">
    <meta name="orientation" content="landscape">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="images/logo-192.png">
    <link rel="apple-touch-icon" href="images/logo-192.png">
    
    
	<!-- Facebook Meta Tags -->
    <meta property="og:url" content="https://hoanganh25991.github.io/threejs-monk-journey">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Monk Journey">
    <meta property="og:description" content="A Diablo Immortal inspired game featuring a monk character">
    <meta property="og:image" content="https://hoanganh25991.github.io/threejs-monk-journey/images/home.jpg">
    <meta property="og:image:width" content="1920">
    <meta property="og:image:height" content="968">

    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta property="twitter:domain" content="hoanganh25991.github.io">
    <meta property="twitter:url" content="https://hoanganh25991.github.io/threejs-monk-journey">
    <meta name="twitter:title" content="Monk Journey">
    <meta name="twitter:description" content="A Diablo Immortal inspired game featuring a monk character">
    <meta name="twitter:image" content="https://hoanganh25991.github.io/threejs-monk-journey/images/home.jpg">
    <meta property="twitter:image:width" content="1920">
    <meta property="twitter:image:height" content="968">
</head>

<body>
    <div id="viewport-rotator">
    <!-- First-time loading screen (orange progress bar; hidden after init) -->
    <div id="loading-screen" style="display: none;">
        <h2>Loading Monk Journey...</h2>
        <div id="loading-bar-container">
            <div id="loading-bar"></div>
        </div>
        <p id="loading-text">Loading resources...</p>
        <p id="loading-info">Downloading game assets...</p>
    </div>

    <!-- Login Modal -->
    <div id="login-modal" class="login-modal-overlay">
        <div class="login-modal-dialog">
            <h3 class="login-modal-title">Login Required</h3>
            <p class="login-modal-message" id="login-modal-message">
                You previously logged in with Google to save your progress. Would you like to login again to load your saved data?
            </p>
            <div class="login-modal-loader"></div>
            <p class="login-modal-status" id="login-modal-status"></p>
            <div class="login-modal-buttons" id="login-modal-buttons">
                <button class="login-btn" id="login-modal-login-btn">Login</button>
                <button class="cancel-btn" id="login-modal-cancel-btn">Start New Game</button>
            </div>
        </div>
    </div>
    
    <!-- Conflict Resolution Modal -->
    <div id="conflict-modal" class="login-modal-overlay">
        <div class="login-modal-dialog">
            <h3 class="login-modal-title">Save Data Conflict</h3>
            <p class="login-modal-message">
                We found different save data on your device and in the cloud. Which version would you like to keep?
            </p>
            <div class="conflict-data-preview">
                <div class="conflict-data-label">Local Save:</div>
                <div id="conflict-local-data"></div>
            </div>
            <div class="conflict-data-preview">
                <div class="conflict-data-label">Cloud Save:</div>
                <div id="conflict-cloud-data"></div>
            </div>
            <div class="login-modal-buttons">
                <button class="login-btn" id="conflict-use-cloud-btn">Use Cloud Version</button>
                <button class="cancel-btn" id="conflict-use-local-btn">Use Local Version</button>
            </div>
        </div>
    </div>

    <!-- Map Selection Modal -->
    <div id="map-selection-modal" class="login-modal-overlay">
        <div class="login-modal-dialog">
            <h3 class="login-modal-title">Map Selection</h3>
            <p class="login-modal-message">
                Map selection feature is coming soon! Stay tuned for exciting new worlds to explore.
            </p>
            <div class="login-modal-buttons">
                <button class="login-btn" id="map-selection-ok-btn">OK</button>
            </div>
        </div>
    </div>

    <!-- Game Container -->
    <div id="game-container">
        <canvas id="game-canvas"></canvas>
    </div>

    <!-- Play reveal overlay: full-screen #EDE4C8, circular shrink into center when game is ready -->
    <div id="play-reveal-overlay" class="play-reveal-overlay" style="display: none;" aria-hidden="true">
        <div class="play-reveal-text" id="play-reveal-text">Preparing your adventure...</div>
    </div>

    <!-- Touch Debug Container -->
    <div id="touch-debug-container" style="
        position: fixed;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 10px;
        border-radius: 5px;
        font-family: monospace;
        font-size: 12px;
        z-index: 9999;
        pointer-events: none;
        min-width: 300px;
        display: none;
    "></div>

    <!-- HUD Container Elements -->
    <div id="hud-container" style="display: none;">
        <!-- Left Side UI (Player Stats, Quest Log) -->
        <div id="left-side-ui">
            <!-- Player UI -->
            <div id="player-stats-container">
                <div id="player-header">
                    <div class="player-header-row">
                        <div id="player-portrait">üßò</div>
                        <div class="player-bars">
                            <div id="health-bar-container">
                                <div id="health-icon">‚ù§Ô∏è</div>
                                <div id="health-bar"></div>
                                <div id="health-text"></div>
                            </div>
                            
                            <div id="mana-bar-container">
                                <div id="mana-icon">üî∑</div>
                                <div id="mana-bar"></div>
                                <div id="mana-text"></div>
                            </div>
                        </div>
                    </div>
                    <div class="player-header-row">
                        <div id="player-info">
                            <div id="level-indicator">Level: 1</div>
                        </div>
                        <div id="experience-bar-container">
                            <div id="experience-icon">‚ú®</div>
                            <div id="experience-bar"></div>
                            <div id="experience-text"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quest Log -->
            <div id="quest-log">
                <div class="quest-title">Active Quests</div>
                <div id="quest-list"></div>
            </div>
        </div>
        
        <!-- Virtual Joystick Container (moved outside left-side-ui) -->
        <div id="virtual-joystick-container">
            <div id="joystick-interaction-overlay"></div>
        </div>

        <!-- Right Side UI (Skills) -->
        <div id="right-side-ui">
            <!-- Camera Control Buttons -->
            <div id="camera-controls">
                <div id="jump-button-slot">
                    <button id="jump-button" class="jump-button" title="Jump (Space)" aria-label="Jump">
                        üöÄ
                        <div class="jump-key">_</div>
                    </button>
                </div>
                <div id="camera-control-button">
                    <div class="camera-icon">üé•</div>
                </div>
                <div id="camera-mode-button">
                    <div class="camera-mode-icon">üëÄ</div>
                </div>
                <!-- Single slot: inventory-teleport (static) or portal-button (purple + rotation) when near portal -->
                <div id="teleport-button-slot">
                    <div id="inventory-teleport" title="Teleport to Origin">
                        <div class="teleport-icon-static">ñ£ê</div>
                    </div>
                    <div id="portal-button" style="display: none;">
                        <div class="portal-icon">ñ£ê</div>
                    </div>
                </div>
            </div>
            
            <!-- Portal Button Container -->
            <div id="portal-button-container"></div>
            
            <!-- Skills UI -->
            <div id="skills-container"></div>
        </div>
        
        <!-- Skills Overlay for touch handling -->
        <div id="skills-overlay"></div>
        
        <!-- Skill Tree UI Container -->
        <div id="skill-tree">
            <div id="skill-tree-header">
                <div id="skill-tree-title">Monk Skill Tree</div>
                <div id="skill-tree-points">Available Points: <span id="skill-points-value">0</span></div>
                <button id="skill-tree-save-btn" class="circle-btn" title="Save Skill Tree">üíæ</button>
            </div>
            <div id="skill-tree-container">
                <div id="skill-tree-view">
                    <div id="skill-tree-skills"></div>
                </div>
                <div id="skill-tree-details">
                    <div id="skill-detail-header">
                        <div id="skill-detail-name">Select a skill</div>
                        <div id="skill-detail-description">Click on a skill to view its details and customize it.</div>
                    </div>
                    <div id="skill-detail-content">
                        <div id="skill-customization-container">
                            <div id="skill-variants-container">
                                <h3>Variants</h3>
                                <div id="skill-variants"></div>
                            </div>
                            <div id="skill-buffs-container">
                                <h3>Buffs</h3>
                                <div id="skill-buffs"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Inventory -->
        <div id="inventory" style="display: none;">
            <div id="inventory-header">
                <div id="inventory-title">Character Inventory</div>
                <div id="inventory-gold">Gold: <span id="gold-value">0</span></div>
                <button id="inventory-save" class="circle-btn" title="Save Inventory">üíæ</button>
            </div>
            <div id="inventory-container">
                <div id="character-equipment">
                    <div id="character-model-container">üë§</div>
                    <div id="equipment-slots">
                        <div class="equipment-slot" data-slot="head">
                            <div class="slot-icon">üß¢</div>
                        </div>
                        <div class="equipment-slot" data-slot="shoulders">
                            <div class="slot-icon">üëî</div>
                        </div>
                        <div class="equipment-slot" data-slot="chest">
                            <div class="slot-icon">üëï</div>
                        </div>
                        <div class="equipment-slot" data-slot="hands">
                            <div class="slot-icon">üß§</div>
                        </div>
                        <div class="equipment-slot" data-slot="weapon">
                            <div class="slot-icon">‚öîÔ∏è</div>
                        </div>
                        <div class="equipment-slot" data-slot="legs">
                            <div class="slot-icon">üëñ</div>
                        </div>
                        <div class="equipment-slot" data-slot="feet">
                            <div class="slot-icon">üëü</div>
                        </div>
                        <div class="equipment-slot" data-slot="accessory">
                            <div class="slot-icon">üíç</div>
                        </div>
                    </div>
                    <!-- Stats button at the bottom of inventory -->
                    <div id="inventory-footer">
                        <button id="show-stats-button" class="inventory-action-btn">
                            <span class="btn-icon">üìä</span>
                            <span class="btn-text">Show Stats</span>
                        </button>
                    </div>
                    <!-- Player stats container moved to overlay -->
                    <div id="player-stats-overlay" style="display: none;">
                        <div id="player-stats-container-inventory">
                            <h3>Player Stats</h3>
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <div class="stat-label">Health</div>
                                    <div class="stat-value" id="stat-health">0/0</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-label">Mana</div>
                                    <div class="stat-value" id="stat-mana">0/0</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-label">Attack</div>
                                    <div class="stat-value" id="stat-attack">0</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-label">Defense</div>
                                    <div class="stat-value" id="stat-defense">0</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-label">Speed</div>
                                    <div class="stat-value" id="stat-speed">0</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-label">Level</div>
                                    <div class="stat-value" id="stat-level">1</div>
                                </div>
                            </div>
                            <button id="close-stats-overlay" class="circle-btn">üíæ</button>
                        </div>
                    </div>
                </div>
                <div id="inventory-items">
                    <h3>Items</h3>
                    <div id="inventory-grid"></div>
                </div>
            </div>
        </div>

        <!-- Skill Selection -->
        <div id="skill-selection" style="display: none;">
            <div id="skill-selection-container">
                <div id="skill-selection-header">
                    <h2>Select Your Skills</h2>
                    <div id="skill-selection-counter">
                        <span id="normal-skills-counter">0/7</span> Normal Skills Selected
                    </div>
                    <button id="skill-selection-save" class="circle-btn" disabled>üíæ</button>
                </div>
                
                <div id="skill-selection-layout">
                    <div id="skill-selection-content">
                        <div id="primary-attack-section">
                            <h3>Primary Attack (Select 1)</h3>
                            <div id="primary-attack-list" class="skill-list single-column"></div>
                        </div>
                        
                        <div id="normal-skills-section">
                            <h3>Normal Skills (Select up to 7)</h3>
                            <div id="normal-skills-list" class="skill-list"></div>
                        </div>
                    </div>
                    
                    <div id="skill-selection-preview">
                        <h3>Battle Skills Layout</h3>
                        <div id="selected-skills-preview" class="battle-layout"></div>
                        <div class="preview-description">
                            <p>This is how your skills will appear in battle</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dialog Box -->
        <div id="dialog-box" style="display: none;">
            <div id="dialog-text"></div>
            <div id="dialog-continue">Click to continue...</div>
        </div>

        <!-- Top Right UI (Home Button, Full Screen Button and Mini Map) -->
        <div id="top-right-container">
            <button id="hud-guide-button" class="circle-btn" title="HUD Guide">‚ÑπÔ∏è</button>
            <button id="map-selector-button" class="circle-btn" title="Map Selector">üó∫Ô∏è</button>
            <button id="inventory-button" class="circle-btn" title="Inventory">üéí</button>
            <button id="skill-tree-button" class="circle-btn" title="Skill Tree">üå≤</button>
            <button id="skill-selection-button" class="circle-btn" title="Skill Selection">‚ú®</button>

            <span class="home-button-wrap">
                <button id="home-button" class="circle-btn" title="Game Menu">‚õ©Ô∏è</button>
                <span id="invite-dot" class="invite-dot" style="display: none;" title="Someone wants to play multiplayer"></span>
            </span>
        </div>

        <!-- Mini Map -->
        <div id="mini-map">
            <div id="mini-map-controls">
                <button id="mini-map-center-btn" title="Center Map">‚åñ</button>
                <button id="mini-map-zoom-in-btn" title="Zoom In">+</button>
                <button id="mini-map-zoom-out-btn" title="Zoom Out">‚àí</button>
            </div>
            <canvas id="mini-map-canvas" width="200" height="200"></canvas>
        </div>

        <!-- Map Selector UI -->
        <div id="map-selector-overlay" class="map-selector-overlay" style="display: none;">
            <div class="map-selector-modal">
                <div class="map-selector-header">
                    <div class="map-selector-header-left">
                        <h2>Select Map</h2>
                        <p id="map-selector-current-label" class="map-selector-current-label" aria-live="polite">Current: ‚Äî</p>
                    </div>
                    <div class="header-buttons">
                        <button class="circle-btn" id="clearCurrentMap" title="Return to Procedural World">üèïÔ∏è</button>
                        <button class="circle-btn" id="generateRandomMap" title="Generate New Map">üë®‚Äçüé®</button>
                        <button class="circle-btn" id="closeMapSelector" title="Save & Close">üíæ</button>
                    </div>
                </div>
                
                <div class="map-selector-content">
                    <div class="map-selector-layout">
                        <div class="map-list-container">
                            <div class="map-list" id="map-list">
                                <!-- Map list items will be populated dynamically -->
                            </div>
                        </div>
                        
                        <div class="map-detail-container">
                            <div class="selected-map-info" id="selectedMapInfo">
                                <div class="map-preview-large" id="map-preview-large">
                                    <div class="map-preview-placeholder">
                                        <span class="map-icon">üó∫Ô∏è</span>
                                    </div>
                                </div>
                                <div class="map-detail-content">
                                    <h4 class="map-name" id="selectedMapName">Select a map</h4>
                                    <p class="map-description" id="selectedMapDescription">Choose a map from the list to view details</p>
                                    
                                    <div class="map-stats" id="selectedMapStats">
                                        <div class="map-stat">
                                            <span class="stat-label">Size:</span>
                                            <span class="stat-value" id="mapSizeStat">-</span>
                                        </div>
                                        <div class="map-stat">
                                            <span class="stat-label">Structures:</span>
                                            <span class="stat-value" id="structuresStat">-</span>
                                        </div>
                                        <div class="map-stat">
                                            <span class="stat-label">Paths:</span>
                                            <span class="stat-value" id="pathsStat">-</span>
                                        </div>
                                        <div class="map-stat">
                                            <span class="stat-label">Environment:</span>
                                            <span class="stat-value" id="environmentStat">-</span>
                                        </div>
                                        <div class="map-stat map-stat-enemies">
                                            <span class="stat-label">Enemies:</span>
                                            <span class="stat-value" id="enemiesStat">-</span>
                                        </div>
                                    </div>
                                        <div class="map-action-buttons" id="mapPlayButtons">
                                        <button class="settings-button play-map-btn" id="playMapButton" title="Apply this map after reload">Apply & Reload</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="loading-overlay" id="mapLoadingOverlay" style="display: none;">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">Loading map...</div>
                </div>
            </div>
        </div>

        <!-- Enemy UI -->
        <div id="enemy-health-container"></div>

        <!-- Notifications Container -->
        <div id="notifications-container"></div>
        
        <!-- Level Up Container -->
        <div id="level-up-container">
            <div class="level-up-content">
                <div class="level-up-text">Level</div>
                <div class="level-up-level"></div>
            </div>
        </div>

        <!-- Teleport Countdown Container -->
        <div id="teleport-countdown-container" style="display: none;">
            <div class="teleport-countdown-content">
                <div class="teleport-countdown-text">TELEPORTING...</div>
                <div class="teleport-countdown-number"></div>
            </div>
        </div>

        <!-- Effects Container -->
        <div id="effects-container"></div>
        
        <!-- Status Effects Container -->
        <div id="status-effects-container" class="status-effects-container"></div>
        
        <!-- Camera Control UI -->
        <div id="camera-control-indicator">
            <div id="camera-control-base">
                <div id="camera-control-arrows">
                    <div class="camera-control-arrow up">‚Üë</div>
                    <div class="camera-control-arrow right">‚Üí</div>
                    <div class="camera-control-arrow down">‚Üì</div>
                    <div class="camera-control-arrow left">‚Üê</div>
                </div>
            </div>
            <div id="camera-control-handle"></div>
        </div>
    </div>

    <!-- Teleport Spiral Effect -->
    <div id="teleport-spiral-container" class="teleport-spiral-container" style="display: none;">
        <div class="spiral-overlay">
            <div class="spiral-center">
                <div class="spiral-symbols">ñ£ê</div>
                <div class="spiral-text">TELEPORTING...</div>
            </div>
            <div class="spiral-rings">
                <div class="spiral-ring ring-1"></div>
                <div class="spiral-ring ring-2"></div>
                <div class="spiral-ring ring-3"></div>
                <div class="spiral-ring ring-4"></div>
            </div>
            <div class="spiral-particles"></div>
        </div>
    </div>

    <!-- HUD Guide Overlay (step-by-step UI introduction) -->
    <div id="guideOverlayRoot" class="guide-overlay hidden" role="dialog" aria-modal="true">
        <div class="guide-blocker"></div>
        <div class="guide-focus"></div>
        <div class="guide-hand">üëâ</div>
        <div class="guide-tooltip">
            <div class="guide-tooltip-header">
                <div class="guide-tooltip-title"></div>
                <button class="guide-close" aria-label="Close guide">‚úï</button>
            </div>
            <div class="guide-tooltip-body"></div>
            <div class="guide-nav">
                <button class="secondary" id="guidePrev">Previous</button>
                <button class="primary" id="guideNext">Next</button>
            </div>
        </div>
    </div>

    <!-- Game Menu -->
    <div id="game-menu" class="game-menu main-background" style="display: none;">
        <h1>Monk Journey</h1>
        <div class="menu-button-container">
            <button id="load-game-button" class="menu-button">Play</button>
            <button id="multiplayer-button" class="menu-button">Multiplayer</button>
            <button id="settings-menu-button" class="menu-button">Settings</button>
        </div>
    </div>

    <!-- Joiner overlay: shown when connecting (Contacts/Rejoin/QR/Enter Code) until startGame or disconnect -->
    <div id="rejoin-overlay" class="rejoin-overlay" style="display: none;" aria-live="polite">
        <div class="rejoin-overlay-message" id="rejoin-overlay-message">Reconnecting...</div>
    </div>

    <!-- Multiplayer Menu -->
    <div id="multiplayer-menu" class="game-menu main-background" style="display: none;">
        <!-- One-touch: HOST or JOIN (touch devices / NFC) -->
        <div class="multiplayer-menu-content" id="multiplayer-initial-screen">
            <div class="modal-header">
                <h2>Play Together</h2>
                <div id="multiplayer-initial-player-info" class="multiplayer-header-player-info" aria-live="polite"></div>
                <button id="close-multiplayer-btn" class="circle-btn" title="Close">‚Ü©Ô∏è</button>
            </div>
            <div id="resume-host-area" class="resume-host-area" style="display: none;">
                <p class="resume-host-msg">Back after network issue? Host again with the same room so joiners can rejoin.</p>
                <button type="button" id="resume-host-btn" class="menu-button one-touch-btn resume-host-btn">Resume hosting</button>
            </div>
            <div class="multiplayer-options one-touch-options">
                <button id="one-touch-host-btn" class="menu-button one-touch-btn host-btn">HOST</button>
                <button id="one-touch-join-btn" class="menu-button one-touch-btn join-btn">JOIN</button>
            </div>
            <div id="multiplayer-initial-status" class="connection-status"></div>
            <p id="nfc-status" class="nfc-status"></p>
        </div>
        
        <!-- Join Game Screen (single screen: permissions row + host area + auto-scan + primary button) -->
        <div class="multiplayer-menu-content fullscreen-layout" id="join-game-screen" style="display: none;">
            <div class="modal-header">
                <h2>Join Game</h2>
                <div id="join-game-player-info" class="multiplayer-header-player-info" aria-live="polite"></div>
                <button id="back-from-join-btn" class="circle-btn" title="Close">‚Ü©Ô∏è</button>
            </div>
            <!-- Permissions: one row ‚Äî green (allowed), Allow button (denied), gray (not supported) -->
            <div id="join-permissions-row" class="join-permissions-row">
                <div id="perm-nfc" class="join-perm-chip" data-perm="nfc">
                    <span class="perm-label">NFC</span>
                    <span id="perm-nfc-status" class="perm-status"></span>
                    <button type="button" id="perm-nfc-allow" class="perm-allow-chip" style="display: none;">Allow</button>
                </div>
                <div id="perm-camera" class="join-perm-chip" data-perm="camera">
                    <span class="perm-label">Camera</span>
                    <span id="perm-camera-status" class="perm-status"></span>
                    <button type="button" id="perm-camera-allow" class="perm-allow-chip">Allow</button>
                </div>
                <div id="perm-microphone" class="join-perm-chip" data-perm="microphone">
                    <span class="perm-label">Mic</span>
                    <span id="perm-microphone-status" class="perm-status"></span>
                    <button type="button" id="perm-microphone-allow" class="perm-allow-chip">Allow</button>
                </div>
            </div>
            <!-- Join via QR or code (no auto-discovery) -->
            <div id="join-host-area" class="join-host-area">
                <div id="join-rejoin-host-area" class="join-rejoin-host-area" style="display: none;">
                    <p class="join-rejoin-msg">Rejoin previous host (e.g. after app reload)? You‚Äôll continue without host clicking Start.</p>
                    <button type="button" id="join-rejoin-host-btn" class="settings-button join-rejoin-btn">Rejoin to last host</button>
                </div>
                <p id="join-host-empty" class="join-host-empty">Use QR scan or Enter Code to join.</p>
            </div>
            <!-- Pending invite from host (shown when Host sent Request and we're on Join screen) -->
            <div id="join-pending-invite-banner" class="join-pending-invite-banner" style="display: none;">
                <p class="join-pending-invite-msg">Host invited you to join.</p>
                <button type="button" id="join-pending-invite-btn" class="settings-button">Join</button>
            </div>
            <!-- Primary action: QR scan or Enter Code -->
            <div id="join-method-status" class="join-method-status join-method-status-compact">
                <div class="join-method-lines">
                    <div id="join-method-nfc" class="join-method-line"></div>
                    <div id="join-method-sound" class="join-method-line"></div>
                </div>
                <div class="join-actions-row join-actions-column">
                    <button type="button" id="join-primary-btn" class="settings-button join-primary-btn">QR scan</button>
                    <button type="button" id="join-enter-code-btn" class="settings-button join-enter-code-btn">Enter Code</button>
                    <button type="button" id="join-contacts-btn" class="settings-button join-contacts-btn" title="Host contacts">üë• Contacts</button>
                    <button type="button" id="join-retry-all-btn" class="settings-button join-retry-all-btn" style="display: none;">Retry</button>
                </div>
            </div>
            <!-- Manual code section (shown when user chooses Enter Code) -->
            <div id="join-manual-code-section" class="join-manual-code-section" style="display: none;">
                <div class="manual-input-section">
                    <div class="input-with-buttons">
                        <input type="text" id="manual-connection-input" placeholder="Enter connection code">
                        <button id="paste-code-btn" class="small-btn" title="Paste from clipboard">üìã</button>
                    </div>
                    <button id="manual-connect-btn" class="settings-button">Connect</button>
                </div>
            </div>
            <div id="join-connection-status" class="connection-status"></div>
            <!-- NFC: ask to confirm before joining (HOST or PLAYER touched this device) -->
            <div id="nfc-join-confirm" class="nfc-join-confirm" style="display: none;">
                <p class="nfc-join-confirm-msg">Game found. Join this game?</p>
                <p class="nfc-join-confirm-code"></p>
                <div class="nfc-join-confirm-btns">
                    <button type="button" id="nfc-join-confirm-join-btn" class="settings-button">Join</button>
                    <button type="button" id="nfc-join-confirm-cancel-btn" class="settings-button secondary-button">Cancel</button>
                </div>
            </div>
            <!-- QR Scan popup: overlay, auto-start scan, on success connect and close -->
            <div id="qr-scan-popup" class="qr-scan-popup" style="display: none;">
                <div class="qr-scan-popup-backdrop"></div>
                <div class="qr-scan-popup-box">
                    <div class="qr-scan-popup-header">
                        <span>Scan QR code</span>
                        <button type="button" id="qr-scan-popup-close" class="circle-btn" title="Close">‚úï</button>
                    </div>
                    <div class="qr-scan-popup-body">
                        <div id="qr-scanner-view"></div>
                        <div id="qr-scanner-loading" class="qr-scanner-loading" style="display: none;">
                            <div class="loading-spinner"></div>
                            <div class="loading-text">Initializing camera...</div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Enter Code popup: same flow as QR (input + Connect, then join and close) -->
            <div id="enter-code-popup" class="qr-scan-popup" style="display: none;">
                <div class="qr-scan-popup-backdrop"></div>
                <div class="qr-scan-popup-box">
                    <div class="qr-scan-popup-header">
                        <span>Enter Code</span>
                        <button type="button" id="enter-code-popup-close" class="circle-btn" title="Close">‚úï</button>
                    </div>
                    <div class="qr-scan-popup-body enter-code-popup-body">
                        <div class="manual-input-section">
                            <div class="input-with-buttons">
                                <input type="text" id="enter-code-popup-input" placeholder="Enter connection code" autocomplete="off">
                                <button type="button" id="enter-code-popup-paste" class="small-btn" title="Paste">üìã</button>
                            </div>
                            <button type="button" id="enter-code-popup-connect" class="settings-button">Connect</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Player Waiting Screen has been removed and functionality merged into connection-info-screen -->
        
        <!-- Connection Info Screen -->
        <div class="multiplayer-menu-content fullscreen-layout" id="connection-info-screen" style="display: none;">
            <div class="modal-header">
                <h2>Multiplayer Connection</h2>
                <div id="connection-info-player-info" class="multiplayer-header-player-info" aria-live="polite"></div>
                <button id="close-connection-info-btn" class="circle-btn" title="Close">‚Ü©Ô∏è</button>
            </div>
            <div class="host-game-layout">
                <div class="qr-section">
                    <div id="connection-info-qr" class="centered-qr"></div>
                    <div class="connection-code-row">
                        <div id="connection-info-code" class="connection-code" title="Click to copy"></div>
                        <button id="connection-copy-code-btn" class="small-btn" title="Copy to clipboard">üìã</button>
                    </div>
                    <div class="connection-status-box">
                        <p id="connection-info-status">Connected</p>
                        <p id="connection-role-info"></p>
                    </div>
                </div>
                <div class="players-section">
                    <h3>Connected Players</h3>
                    <div id="connection-info-players" class="connected-players-list">
                        <!-- Players will be added here dynamically -->
                    </div>
                    <div class="multiplayer-action" id="host-controls">
                        <!-- Host-specific controls will be shown here when user is host -->
                        <button type="button" id="host-contacts-btn" class="settings-button join-contacts-btn" title="Ask contacts to join your game">üë• Contacts</button>
                        <button id="start-game-btn" class="settings-button">Start Game</button>
                        <button id="disconnect-btn" class="settings-button danger-button">Disconnect</button>
                    </div>
                </div>
            </div>
            <div id="connection-info-status-bar" class="connection-status"></div>
        </div>
        <!-- Contacts popup: used from Join screen (Join) and Host connection screen (Request). Must be sibling of screens so it shows when connection-info-screen is visible. -->
        <div id="contacts-popup" class="qr-scan-popup" style="display: none;">
            <div class="qr-scan-popup-backdrop"></div>
            <div class="qr-scan-popup-box contacts-popup-box">
                <div class="qr-scan-popup-header contacts-popup-header-tabs">
                    <div class="contacts-popup-tabs">
                        <button type="button" id="contacts-tab-list-btn" class="contacts-tab-btn contacts-tab-active" title="Host contacts">üë•</button>
                        <button type="button" id="contacts-tab-manage-btn" class="contacts-tab-btn" title="Manage contacts">‚úèÔ∏è</button>
                    </div>
                    <button type="button" id="contacts-popup-close" class="circle-btn" title="Close">‚úï</button>
                </div>
                <div class="contacts-popup-body">
                    <p id="contacts-popup-hint" class="contacts-popup-hint">Pick a host and tap Join to reconnect.</p>
                    <ul id="contacts-list" class="contacts-list"></ul>
                    <p id="contacts-empty" class="contacts-empty" style="display: none;">No contacts. Join a host first (QR or Enter Code).</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Menu -->
    <div id="main-options-menu" class="game-menu main-background top-tabs-layout" style="display: none;">
        <!-- Settings Icon in Top-Right -->
        <!-- <div class="settings-header-icon">‚öôÔ∏è</div> -->
        <div class="settings-header-icon">
            <button id="settings-save-button" class="circle-btn" title="Save Settings">üíæ</button>
        </div>

        <!-- Top Tabs with Right Actions Layout -->
        <div class="top-tabs-container">
            <!-- Top Row with Tabs -->
            <div class="top-tabs-row">
                <div class="top-tabs">
                    <button id="tab-game" class="tab-icon" title="Game">üéÆ</button>
                    <button id="tab-camera" class="tab-icon" title="Camera">üì∑</button>
                    <button id="tab-controls" class="tab-icon" title="Controls">üéõÔ∏è</button>
                    <button id="tab-audio" class="tab-icon" title="Audio">üîä</button>
                    <button id="tab-hud" class="tab-icon" title="HUD">üìä</button>
                    <button id="tab-model-preview" class="tab-icon" title="Model Preview">üë§</button>
                    <button id="tab-skills-preview" class="tab-icon" title="Skills Preview">‚ú®</button>
                    <button id="tab-enemy-preview" class="tab-icon" title="Enemy Preview">üëπ</button>
                    <button id="tab-item-preview" class="tab-icon" title="Item Preview">üéÅ</button>
                    <button id="tab-debug" class="tab-icon active" title="Debug">üêû</button>
                </div>
            </div>
            
            <!-- Right Column with Action Buttons -->
            <div class="right-actions-column">
            </div>

            <div class="settings-content">
                <!-- Game Settings Tab -->
                <div id="game-tab" class="tab-content active">
                    <h2 id="game-title">Game Settings</h2>
                    <div class="settings-section">
                        <!-- Google Login Section -->
                        <div id="google-login-section" class="setting-item">
                            <h3>Account Sync</h3>
                            <div class="setting-row">
                                <div class="settings-label">Google Account</div>
                                <div class="settings-google-login">
                                    <button id="google-login-button" class="settings-button google-login-button" title="Sign in with Google">
                                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBkPSJNMTcuNiA5LjJsLS4xLTEuOEg5djMuNGg0LjhDMTMuNiAxMiAxMyAxMyAxMiAxMy42djIuMmgzYTguOCA4LjggMCAwIDAgMi42LTYuNnoiIGZpbGw9IiM0Mjg1RjQiIGZpbGwtcnVsZT0ibm9uemVybyIvPjxwYXRoIGQ9Ik05IDE4YzIuNCAwIDQuNS0uOCA2LTIuMmwtMy0yLjJhNS40IDUuNCAwIDAgMS04LTIuOUgxVjEzYTkgOSAwIDAgMCA4IDV6IiBmaWxsPSIjMzRBODUzIiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNNCAxMC43YTUuNCA1LjQgMCAwIDEgMC0zLjRWNUgxYTkgOSAwIDAgMCAwIDhsMy0yLjN6IiBmaWxsPSIjRkJCQzA1IiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNOSAzLjZjMS4zIDAgMi41LjQgMy40IDEuM0wxNSAyLjNBOSA5IDAgMCAwIDEgNWwzIDIuNGE1LjQgNS40IDAgMCAxIDUtMy43eiIgZmlsbD0iI0VBNDMzNSIgZmlsbC1ydWxlPSJub256ZXJvIi8+PHBhdGggZD0iTTAgMGgxOHYxOEgweiIvPjwvZz48L3N2Zz4=" alt="Google">
                                    </button>
                                    <div class="google-login-status signed-out" style="display: none;"></div>
                                </div>
                            </div>
                            <div class="setting-row" id="auto-login-container" style="display: none;">
                                <div class="settings-label">Auto Login</div>
                                <div class="settings-control">
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="auto-login-checkbox">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                            <div class="settings-description">Sync your game progress across devices</div>
                        </div>
                        
                        <!-- Performance Profile (for low-end tablets) -->
                        <div id="material-quality-container" class="setting-item">
                            <h3>Performance Profile</h3>
                            <div class="setting-row">
                                <label for="material-quality-select" class="settings-label">Profile</label>
                                <select id="material-quality-select" class="settings-select"></select>
                            </div>
                            <div class="settings-description">Lower profile = better performance on low-end tablets. If game freezes, try Low or Minimal.</div>
                        </div>

                        <!-- Game Difficulty Setting -->
                        <div id="difficulty-container" class="setting-item">
                            <h3>Game Difficulty</h3>
                            <div class="setting-row">
                                <label for="difficulty-select" class="settings-label">Difficulty Level</label>
                                <select id="difficulty-select" class="settings-select"></select>
                            </div>
                            <div class="settings-description">Choose the difficulty level for your game experience</div>
                        </div>
                        
                        <!-- Game Control -->
                        <div id="new-game-container" class="setting-item">
                            <h3>Game Control</h3>
                            <div class="setting-row">
                                <div class="settings-label">Reset Game Progress</div>
                                <button id="new-game-button" class="settings-button">New Game</button>
                            </div>
                            <div class="settings-description">Start a new game (current progress will be lost)</div>
                        </div>
                        
                        <!-- Version Control -->
                        <div id="version-container" class="setting-item">
                            <h3>Version Control</h3>
                            <div class="setting-row">
                                <div class="settings-label">Current Version</div>
                                <span id="current-version" class="settings-value">Current Version</span>
                            </div>
                            <div class="setting-row">
                                <div class="settings-label">Update Game</div>
                                <button id="update-to-latest-button" class="settings-button">Update to Latest</button>
                            </div>
                            <div class="settings-description">Load latest code from server (bypasses cache)</div>
                        </div>
                    </div>
                </div>

                <!-- Camera Settings Tab (render-related: camera, UI, FPS) -->
                <div id="camera-tab" class="tab-content">
                    <h2 id="camera-title">Camera Settings</h2>
                    <div class="settings-section">
                        <div id="camera-settings-container" class="setting-item">
                            <h3>Camera</h3>
                            <div class="setting-row">
                                <label for="camera-zoom-slider" class="settings-label">Camera Zoom</label>
                                <div style="display: flex; align-items: center;">
                                    <input type="range" id="camera-zoom-slider" class="settings-slider" min="0.1" max="100" step="0.1" value="10">
                                    <span id="camera-zoom-value" class="settings-value">10</span>
                                </div>
                            </div>
                            <div class="settings-description">Adjust camera distance (higher values = further away)</div>
                        </div>
                        <!-- UI / Render Settings -->
                        <div id="ui-settings-container" class="setting-item">
                            <h3>UI Settings</h3>
                            <div id="show-minimap-container" class="setting-row">
                                <label for="show-minimap-checkbox" class="settings-label">Show Mini Map</label>
                                <input type="checkbox" id="show-minimap-checkbox" class="settings-checkbox" checked>
                            </div>
                            <div class="settings-description">Toggle mini map visibility in the top-right corner</div>
                        </div>
                        <div id="fps-container" class="setting-item">
                            <label for="fps-slider" class="settings-label">Target FPS: </label>
                            <input type="range" id="fps-slider" class="settings-slider" min="30" max="240" step="5" value="120">
                            <span id="fps-value" class="settings-value">120 FPS</span>
                        </div>
                    </div>
                </div>

                <!-- Controls Settings Tab -->
                <div id="controls-tab" class="tab-content">
                    <h2 id="controls-title">Controls Settings</h2>
                    <div class="settings-section">
                        <div id="mobile-controls-container" class="setting-item">
                            <h3>Mobile Controls</h3>
                            <!-- Controls will be dynamically generated here -->
                        </div>
                        <div id="keyboard-controls-container" class="setting-item">
                            <h3>Keyboard Controls</h3>
                            <!-- Controls will be dynamically generated here -->
                        </div>
                    </div>
                </div>

                <!-- Audio Settings Tab -->
                <div id="audio-tab" class="tab-content">
                    <h2 id="audio-title">Audio Settings</h2>
                    <div id="audio-controls-container" class="settings-section">
                        <!-- Main Audio Controls -->
                        <div id="main-audio-container" class="setting-item">
                            <h3>Main Audio Controls</h3>
                            <div class="setting-row">
                                <label for="mute-checkbox" class="settings-label">Mute All Audio</label>
                                <input type="checkbox" id="mute-checkbox" class="settings-checkbox">
                            </div>
                            <div class="settings-description">Toggle all game audio on or off</div>
                        </div>
                        
                        <!-- Volume Controls -->
                        <div id="volume-controls-container" class="setting-item">
                            <h3>Volume Controls</h3>
                            <div class="setting-row">
                                <label for="music-volume-slider" class="settings-label">Music Volume</label>
                                <div style="display: flex; align-items: center;">
                                    <input type="range" id="music-volume-slider" class="settings-slider" min="0" max="100" value="80">
                                    <span id="music-volume-value" class="settings-value">80%</span>
                                </div>
                            </div>
                            <div class="setting-row">
                                <label for="sfx-volume-slider" class="settings-label">SFX Volume</label>
                                <div style="display: flex; align-items: center;">
                                    <input type="range" id="sfx-volume-slider" class="settings-slider" min="0" max="100" value="80">
                                    <span id="sfx-volume-value" class="settings-value">80%</span>
                                </div>
                            </div>
                            <div class="settings-description">Adjust volume levels for music and sound effects separately</div>
                        </div>
                        
                        <!-- Test Sound -->
                        <div id="test-sound-container" class="setting-item">
                            <h3>Sound Test</h3>
                            <div class="setting-row">
                                <div class="settings-label">Play Test Sound</div>
                                <button id="test-sound-button" class="settings-button">Test Sound</button>
                            </div>
                            <div class="settings-description">Play a test sound to check your current volume settings</div>
                        </div>

                        <div id="audio-disabled-message" style="display: none;" class="setting-item">
                            <h3>Audio Unavailable</h3>
                            <div class="settings-description">Audio is currently disabled. Audio files need to be added to the assets/audio directory.</div>
                        </div>

                        <div id="simulated-audio-note" style="display: none;">
                            Using simulated audio. For better audio experience, add audio files to the assets/audio
                            directory.
                        </div>
                    </div>
                </div>

                <!-- Model Preview Tab (Dedicated) -->
                <div id="model-preview-tab" class="tab-content">
                    <!-- <h2 id="model-preview-title">Model Preview</h2> -->
                    <div class="model-preview-fullscreen-layout">
                        <div class="model-preview-fullscreen-section">
                            <!-- Regular model preview container -->
                            <div id="model-preview-container">
                                <div id="model-preview-wrapper"></div>
                            </div>
                            
                            <!-- Fullscreen model preview container -->
                            <div id="model-preview-fullscreen-container">
                                <div id="model-preview-fullscreen-wrapper"></div>
                            </div>
                        </div>
                        <div class="model-preview-controls-section">
                            <!-- Regular model selection (for CharacterModelTab.js) -->
                            <div id="model-selection" class="setting-item">
                                <label for="model-select" class="settings-label">Model: </label>
                                <button id="prev-model-button" class="settings-button">‚óÄ</button>
                                <select id="model-select" class="settings-select"></select>
                                <button id="next-model-button" class="settings-button">‚ñ∂</button>
                            </div>
                            
                            <!-- Animation selection -->
                            <div id="animation-selection" class="setting-item">
                                <label for="animation-select" class="settings-label">Animation: </label>
                                <button id="prev-anim-button" class="settings-button">‚óÄ</button>
                                <select id="animation-select" class="settings-select"></select>
                                <button id="next-anim-button" class="settings-button">‚ñ∂</button>
                            </div>

                            <div id="camera-controls-container" class="setting-item">
                                <h3>Camera Controls</h3>
                                <div class="camera-controls">
                                    <button id="reset-camera-button" class="settings-button">Reset Camera</button>
                                    <!-- Auto-rotate and rotation speed controls have been removed -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Skills Preview Tab -->
                <div id="skills-preview-tab" class="tab-content">
                    <div class="skills-preview-layout">
                        <div class="skills-preview-section">
                            <div id="skills-preview-container">
                                <div id="skills-preview-wrapper" style="width: 100%; height: 100%;">
                                    <!-- Camera Info Panel Template -->
                                    <template id="camera-info-template">
                                        <div class="camera-info-panel">
                                            <div id="camera-info-content" class="camera-info-content" style="display: none;">
                                                <div class="camera-info-section">
                                                    <div class="camera-info-row"><span class="camera-info-label">Camera Position:</span></div>
                                                    <div class="camera-info-row">X: <span class="camera-pos-x camera-info-value">0.00</span></div>
                                                    <div class="camera-info-row">Y: <span class="camera-pos-y camera-info-value">0.00</span></div>
                                                    <div class="camera-info-row">Z: <span class="camera-pos-z camera-info-value">0.00</span></div>
                                                </div>
                                                <div class="camera-info-section">
                                                    <div class="camera-info-row"><span class="camera-info-label">Distance:</span> <span class="camera-distance camera-info-value">0.00</span></div>
                                                    <div class="camera-info-row"><span class="camera-info-label">Zoom:</span> <span class="camera-zoom camera-info-value">0%</span></div>
                                                </div>
                                                <div class="camera-info-section">
                                                    <div class="camera-info-row"><span class="camera-info-label">Target:</span></div>
                                                    <div class="camera-info-row">X: <span class="camera-target-x camera-info-value">0.00</span>, 
                                                       Y: <span class="camera-target-y camera-info-value">0.00</span>, 
                                                       Z: <span class="camera-target-z camera-info-value">0.00</span></div>
                                                </div>
                                                <div class="camera-info-section">
                                                    <div class="camera-info-row"><span class="camera-info-label">Controls:</span></div>
                                                    <div class="camera-info-row">Min Distance: <span class="camera-min-distance camera-info-value">0.00</span></div>
                                                    <div class="camera-info-row">Max Distance: <span class="camera-max-distance camera-info-value">0.00</span></div>
                                                </div>
                                            </div>
                                            <button id="reset-camera-button" class="camera-info-button">Reset Camera</button>
                                            <button id="toggle-info-button" class="camera-info-toggle">Hide Info</button>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                        <div class="skills-preview-controls-section">
                            <h2 id="skills-preview-title">Skills Preview</h2>
                            <div id="skills-selection" class="setting-item">
                                <label for="skills-preview-select" class="settings-label">Skill: </label>
                                <div id="skills-preview-selection-container">
                                    <button id="prev-skill-button" class="settings-button">‚óÄ</button>
                                    <select id="skills-preview-select" class="settings-select"></select>
                                    <button id="next-skill-button" class="settings-button">‚ñ∂</button>
                                </div>
                            </div>
                            <div id="skill-details-container" class="setting-item">
                                <div id="skill-details" class="skill-details-info">
                                    <!-- Skill details will be populated dynamically -->
                                </div>
                            </div>
                            <div id="skill-variants-container" class="setting-item">
                                <label for="skill-variants-select" class="settings-label">Variant: </label>
                                <button id="prev-variant-button" class="settings-button">‚óÄ</button>
                                <select id="skill-variants-select" class="settings-select"></select>
                                <button id="next-variant-button" class="settings-button">‚ñ∂</button>
                                <div id="variant-info"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Item Preview Tab -->
                <div id="item-preview-tab" class="tab-content">
                    <h2 id="item-preview-title">Item Preview</h2>
                    <div class="item-preview-layout">
                        <div class="item-preview-section">
                            <div id="item-preview-container">
                                <!-- Item preview will be rendered here -->
                            </div>
                            <div class="item-preview-controls">
                                <button id="reset-item-camera-button" class="settings-button">Reset Camera</button>
                                <button id="generate-random-item-button" class="settings-button">Generate Random Item</button>
                            </div>
                        </div>
                        <div class="item-preview-options">
                            <div class="item-filter-controls">
                                <div class="setting-item">
                                    <label for="item-type-select" class="settings-label">Item Type:</label>
                                    <select id="item-type-select" class="settings-select">
                                        <option value="all">All Types</option>
                                    </select>
                                </div>
                                <div class="setting-item">
                                    <label for="item-sub-type-select" class="settings-label">Item Subtype:</label>
                                    <select id="item-sub-type-select" class="settings-select">
                                        <option value="all">All Subtypes</option>
                                    </select>
                                </div>
                                <div class="setting-item">
                                    <label for="item-rarity-select" class="settings-label">Item Rarity:</label>
                                    <select id="item-rarity-select" class="settings-select">
                                        <option value="all">All Rarities</option>
                                    </select>
                                </div>
                            </div>
                            <div class="item-navigation">
                                <button id="prev-item-button" class="nav-button">‚óÄ Previous</button>
                                <button id="next-item-button" class="nav-button">Next ‚ñ∂</button>
                            </div>
                            <div id="item-details" class="item-details">
                                <!-- Item details will be displayed here -->
                            </div>
                            <div class="item-behavior-settings">
                                <h3 class="settings-subtitle">Item behavior</h3>
                                <div class="setting-item">
                                    <label class="settings-toggle-label">
                                        <input type="checkbox" id="auto-pick-items" checked>
                                        <span>Auto pick items (when close)</span>
                                    </label>
                                </div>
                                <div class="setting-item">
                                    <label class="settings-toggle-label">
                                        <input type="checkbox" id="auto-consume-items" checked>
                                        <span>Auto consume when picked up</span>
                                    </label>
                                </div>
                                <div class="setting-item">
                                    <label class="settings-toggle-label">
                                        <input type="checkbox" id="auto-equip-items" checked>
                                        <span>Auto equip stronger items</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Enemy Preview Tab -->
                <div id="enemy-preview-tab" class="tab-content">
                    <h2 id="enemy-preview-title">Enemy Preview</h2>
                    <div class="enemy-preview-layout">
                        <div class="enemy-preview-section">
                            <div id="enemy-preview-container">
                                <div id="enemy-preview-wrapper" style="width: 100%; height: 100%;">
                                    <!-- Camera Info Panel Template -->
                                    <template id="enemy-camera-info-template">
                                        <div class="camera-info-panel">
                                            <div id="enemy-camera-info-content" class="camera-info-content">
                                                <div class="camera-info-section">
                                                    <div class="camera-info-row"><span class="camera-info-label">Camera Position:</span></div>
                                                    <div class="camera-info-row">X: <span class="camera-pos-x camera-info-value">0.00</span></div>
                                                    <div class="camera-info-row">Y: <span class="camera-pos-y camera-info-value">0.00</span></div>
                                                    <div class="camera-info-row">Z: <span class="camera-pos-z camera-info-value">0.00</span></div>
                                                </div>
                                                <div class="camera-info-section">
                                                    <div class="camera-info-row"><span class="camera-info-label">Distance:</span> <span class="camera-distance camera-info-value">0.00</span></div>
                                                    <div class="camera-info-row"><span class="camera-info-label">Zoom:</span> <span class="camera-zoom camera-info-value">0%</span></div>
                                                </div>
                                                <div class="camera-info-section">
                                                    <div class="camera-info-row"><span class="camera-info-label">Target:</span></div>
                                                    <div class="camera-info-row">X: <span class="camera-target-x camera-info-value">0.00</span>, 
                                                       Y: <span class="camera-target-y camera-info-value">0.00</span>, 
                                                       Z: <span class="camera-target-z camera-info-value">0.00</span></div>
                                                </div>
                                                <div class="camera-info-section">
                                                    <div class="camera-info-row"><span class="camera-info-label">Controls:</span></div>
                                                    <div class="camera-info-row">Min Distance: <span class="camera-min-distance camera-info-value">0.00</span></div>
                                                    <div class="camera-info-row">Max Distance: <span class="camera-max-distance camera-info-value">0.00</span></div>
                                                </div>
                                            </div>
                                            <button id="reset-enemy-camera-button" class="camera-info-button">Reset Camera</button>
                                            <button id="toggle-enemy-info-button" class="camera-info-toggle">Hide Info</button>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                        <div class="enemy-preview-controls-section">
                            <div id="enemy-selection" class="setting-item">
                                <label for="enemy-preview-select" class="settings-label">Enemy: </label>
                                <div id="enemy-preview-selection-container">
                                    <button id="prev-enemy-button" class="settings-button">‚óÄ</button>
                                    <select id="enemy-preview-select" class="settings-select"></select>
                                    <button id="next-enemy-button" class="settings-button">‚ñ∂</button>
                                </div>
                            </div>
                            <div id="animation-selection" class="setting-item">
                                <label for="enemy-animation-select" class="settings-label">Animation: </label>
                                <div id="enemy-animation-selection-container">
                                    <button id="prev-enemy-anim-button" class="settings-button">‚óÄ</button>
                                    <select id="enemy-animation-select" class="settings-select"></select>
                                    <button id="next-enemy-anim-button" class="settings-button">‚ñ∂</button>
                                </div>
                            </div>
                            <div id="enemy-details-container" class="setting-item">
                                <!-- <h3>Enemy Details</h3> -->
                                <div id="enemy-details" class="enemy-details-info">
                                    <!-- Enemy details will be populated dynamically -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Performance Settings Tab -->
                <!-- HUD Tab -->
                <div id="hud-tab" class="tab-content">
                    <h2 id="hud-title">HUD Preview</h2>
                    <div id="hud-preview-container" class="settings-section">
                        <!-- Enemy Health Bar Preview -->
                        <div class="setting-item">
                            <h3>Enemy Health Bar</h3>
                            <!-- Mock Enemy Health Bar - Contained within settings -->
                            <div style="display: flex; justify-content: center; align-items: center; min-height: 60px; margin: 10px 0;">
                                <div style="width: 300px;">
                                    <!-- Enemy Name -->
                                    <div style="text-align: center; color: white; font-size: 14px; text-shadow: 1px 1px 2px black; margin-bottom: 5px;">
                                        Elite Skeleton Warrior
                                    </div>
                                    <!-- Health Bar Container -->
                                    <div style="position: relative; width: 100%; height: 1rem; background-color: rgba(0, 0, 0, 0.5); border: 2px solid #333; border-radius: 5px; overflow: hidden;">
                                        <!-- Health Bar Fill -->
                                        <div style="height: 100%; width: 66.67%; background-color: #f00; border-radius: 3px;"></div>
                                        <!-- Health Text -->
                                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 12px; text-shadow: 1px 1px 2px black; white-space: nowrap;">
                                            2000 / 3000
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="settings-description">
                                Preview of the enemy health bar that appears at the top center of the screen during combat.
                            </div>
                        </div>

                        <!-- Test Notifications -->
                        <div class="setting-item">
                            <h3>Test Notifications</h3>
                            <div class="settings-description" style="margin-bottom: 10px;">
                                Click the buttons below to see how each notification type looks:
                            </div>
                            
                            <div class="setting-row">
                                <div class="settings-label">Test Pick Notification</div>
                                <button id="test-notification-pick" class="settings-button">Show Pick</button>
                            </div>
                            
                            <div class="setting-row">
                                <div class="settings-label">Test Equip Notification</div>
                                <button id="test-notification-equip" class="settings-button">Show Equip</button>
                            </div>
                            
                            <div class="setting-row">
                                <div class="settings-label">Test Skip Notification</div>
                                <button id="test-notification-skip" class="settings-button">Show Skip</button>
                            </div>
                            
                            <div class="setting-row">
                                <div class="settings-label">Test Consume Health</div>
                                <button id="test-notification-consume-health" class="settings-button">Show Health</button>
                            </div>
                            
                            <div class="setting-row">
                                <div class="settings-label">Test Consume Mana</div>
                                <button id="test-notification-consume-mana" class="settings-button">Show Mana</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="debug-tab" class="tab-content">
                    <h2 id="debug-title">Debug Settings</h2>
                    <div id="debug-container" class="settings-section">
                        <div id="disable-full-screen-container" class="setting-item">
                            <label for="disable-full-screen-checkbox" class="settings-label">Disable Full Screen: </label>
                            <input type="checkbox" id="disable-full-screen-checkbox" class="settings-checkbox">
                            <span class="settings-description">Prevent automatic fullscreen mode activation</span>
                        </div>
                        <div id="show-debug-info-container" class="setting-item">
                            <label for="show-debug-info-checkbox" class="settings-label">Show Performance Info (FPS, GPU, Quality): </label>
                            <input type="checkbox" id="show-debug-info-checkbox" class="settings-checkbox" checked>
                        </div>
                        <div id="log-enabled-container" class="setting-item">
                            <label for="log-enabled-checkbox" class="settings-label">Enable Console Logs: </label>
                            <input type="checkbox" id="log-enabled-checkbox" class="settings-checkbox">
                            <span class="settings-description">Disable for better performance (requires page reload)</span>
                        </div>
                    </div>
                </div>

                <!-- Model Settings Tab removed -->
            </div>
        </div>

        <!-- Settings Footer Buttons removed - now in sidebar -->
    </div>

    <!-- Death Screen -->
    <div id="death-screen" class="game-menu" style="display: none;"></div>

    <!-- Orientation Lock -->
    <script src="pwa/orientation-lock.js"></script>

    <!-- Import Three.js from local files (r154, patched) -->
    <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
    <script type="importmap">
        {
            "imports": {
                "three": "./libs/three/three.module.js",
                "three/addons/": "./libs/three/examples/jsm/",
                "utils/FastMath.js": "./js/utils/FastMath.js"
            }
        }
    </script>

    <!-- Service Worker Registration -->
    <script src="pwa/registration.js"></script>

    <!-- Simple Peer Library - Removed external dependency and using our own implementation -->
    <!-- The SimplePeer implementation is now included directly in SimplePeerConnection.js -->

    <!-- MessagePack Library for Binary Serialization -->
    <script src="https://unpkg.com/@msgpack/msgpack@3.1.1/dist.umd/msgpack.min.js"></script>

    <!-- PeerJS Library for WebRTC connections -->
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>

    <!-- Google API -->
    <script src="https://accounts.google.com/gsi/client"></script>

    <style>
        /* Navigation buttons for selects - Moved to settings-menu.css */

        /* Game Menu Headings */
        #game-menu h1, .game-menu h1 {
            color: #f5f5f5;
            font-size: 48px;
            text-shadow: 0 0 10px #ff6600;
        }
    </style>

    </div><!-- #viewport-rotator -->

    <!-- Orientation message: outside rotator so it stays fixed to the real viewport in portrait -->
    <div id="orientation-message" style="display: none;">
        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
            <rect x="5" y="2" width="14" height="20" rx="2" ry="2" />
            <path d="M12 18h.01" />
        </svg>
        <p>Please rotate your device to landscape mode for the best experience</p>
    </div>

    <!-- Main script module -->
    <script type="module" src="js/Main.js"></script>
</body>

</html>